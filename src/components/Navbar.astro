---
const currentPath = Astro.url.pathname;

const isActive = (path: string) => currentPath === path;

const linkClass = (path: string) =>
  `group relative inline-block transition-colors duration-200 ${
    isActive(path)
      ? "text-emerald-600 dark:text-emerald-400 font-semibold"
      : "text-gray-700 dark:text-gray-300 hover:text-emerald-600 dark:hover:text-emerald-400"
  }`;
---

<!-- Mobile dropdown -->
<div
  id="mobile-nav"
  class="lg:hidden hidden mt-3 rounded-2xl border border-gray-200/70 dark:border-white/10
         bg-white/80 dark:bg-slate-900/40 backdrop-blur p-3
         shadow-lg shadow-emerald-500/10"
  data-mobile-menu
>
  <nav class="flex flex-col gap-1 text-base">
    <a
      href="/"
      class="rounded-xl px-3 py-2 text-gray-800 dark:text-gray-200 hover:bg-emerald-500/10"
      >Home</a
    >
    <a
      href="/about"
      class="rounded-xl px-3 py-2 text-gray-800 dark:text-gray-200 hover:bg-emerald-500/10"
      >About</a
    >
    <a
      href="/help"
      class="rounded-xl px-3 py-2 text-gray-800 dark:text-gray-200 hover:bg-emerald-500/10"
      >How I Can Help</a
    >
    <a
      href="/experience"
      class="rounded-xl px-3 py-2 text-gray-800 dark:text-gray-200 hover:bg-emerald-500/10"
      >Experience</a
    >
    <a
      href="/certifications"
      class="rounded-xl px-3 py-2 text-gray-800 dark:text-gray-200 hover:bg-emerald-500/10"
      >Certifications</a
    >
    <a
      href="/faq"
      class="rounded-xl px-3 py-2 text-gray-800 dark:text-gray-200 hover:bg-emerald-500/10"
      >FAQ</a
    >

    <a
      href="/contact"
      class="mt-2 inline-flex items-center justify-center rounded-xl px-4 py-2 font-semibold
             bg-emerald-500 text-white hover:bg-emerald-600 transition"
    >
      Contact <span
        class="ml-2 inline-block h-2 w-2 rounded-full bg-white/90"
        aria-hidden="true"></span>
    </a>
  </nav>
</div>

<nav class="w-full border-b border-gray-200 dark:border-gray-700">
  <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
    <!-- Left: Name + Mini Avatar -->
    <div class="flex items-center gap-3 font-semibold">
      <!-- Mini avatar -->
      <div class="relative group">
        <!-- Glow -->
        <div
          class="pointer-events-none absolute inset-0 rounded-full
                 bg-gradient-to-br from-emerald-500 via-teal-400 to-cyan-400
                 blur-lg opacity-50
                 transition-opacity duration-500
                 group-hover:opacity-90"
          aria-hidden="true"
        >
        </div>

        <!-- Frame -->
        <div
          class="relative w-10 h-10 md:w-12 md:h-12 rounded-full
                 bg-gradient-to-br from-emerald-400 via-teal-400 to-green-500
                 p-[2px]"
        >
          <!-- Image -->
          <div
            class="w-full h-full rounded-full bg-gray-900 overflow-hidden
                   border border-white/10"
          >
            <img
              src="/assets/images/PerfilDibujo.png"
              class="w-full h-full object-cover
                     transition-transform duration-500
                     group-hover:scale-105"
              loading="eager"
            />
          </div>
        </div>
      </div>

      <!-- Name -->
      <a href="/" class="group">
        <span
          class="text-xl md:text-2xl
           bg-gradient-to-r from-emerald-400 via-teal-400 to-green-500
           dark:from-emerald-300 dark:via-teal-300 dark:to-green-400
           bg-clip-text text-transparent
           tracking-tight
           transition-opacity duration-200
           group-hover:opacity-90"
        >
          Raulgb
        </span>
      </a>
    </div>

    <!-- Center: Navigation links -->
    <ul class="hidden lg:flex items-center gap-6 text-lg">
      <li>
        <a href="/" class={linkClass("/")}>
          Home
          <span
            class={`absolute left-0 -bottom-1 h-[2px] w-full origin-left scale-x-0 bg-emerald-600 dark:bg-emerald-400 transition-transform duration-200 ${
              isActive("/") ? "scale-x-100" : "group-hover:scale-x-100"
            }`}></span>
        </a>
      </li>

      <li>
        <a href="/about" class={linkClass("/about")}>
          About
          <span
            class={`absolute left-0 -bottom-1 h-[2px] w-full origin-left scale-x-0 bg-emerald-600 dark:bg-emerald-400 transition-transform duration-200 ${
              isActive("/about") ? "scale-x-100" : "group-hover:scale-x-100"
            }`}></span>
        </a>
      </li>

      <li>
        <a href="/help" class={linkClass("/help")}>
          How I Can Help
          <span
            class={`absolute left-0 -bottom-1 h-[2px] w-full origin-left scale-x-0 bg-emerald-600 dark:bg-emerald-400 transition-transform duration-200 ${
              isActive("/help") ? "scale-x-100" : "group-hover:scale-x-100"
            }`}></span>
        </a>
      </li>

      <li>
        <a href="/experience" class={linkClass("/experience")}>
          Experience
          <span
            class={`absolute left-0 -bottom-1 h-[2px] w-full origin-left scale-x-0 bg-emerald-600 dark:bg-emerald-400 transition-transform duration-200 ${
              isActive("/experience")
                ? "scale-x-100"
                : "group-hover:scale-x-100"
            }`}></span>
        </a>
      </li>

      <li>
        <a href="/certifications" class={linkClass("/certifications")}>
          Certifications
          <span
            class={`absolute left-0 -bottom-1 h-[2px] w-full origin-left scale-x-0 bg-emerald-600 dark:bg-emerald-400 transition-transform duration-200 ${
              isActive("/certifications")
                ? "scale-x-100"
                : "group-hover:scale-x-100"
            }`}></span>
        </a>
      </li>

      <li>
        <a href="/faq" class={linkClass("/faq")}>
          FAQ
          <span
            class={`absolute left-0 -bottom-1 h-[2px] w-full origin-left scale-x-0 bg-emerald-600 dark:bg-emerald-400 transition-transform duration-200 ${
              isActive("/faq") ? "scale-x-100" : "group-hover:scale-x-100"
            }`}></span>
        </a>
      </li>

      <li>
        <a
          href="/contact"
          class={`relative inline-flex items-center justify-center rounded-full px-5 py-2 font-semibold
      transition-all duration-300
      ${
        isActive("/contact")
          ? "bg-emerald-500 text-white shadow-lg shadow-emerald-500/25"
          : "bg-emerald-500/10 text-emerald-600 ring-1 ring-emerald-500/30 hover:bg-emerald-500/15 hover:text-emerald-700 hover:ring-emerald-500/50"
      }
      dark:${
        isActive("/contact")
          ? "bg-emerald-400 text-slate-950 shadow-lg shadow-emerald-400/20"
          : "bg-emerald-400/10 text-emerald-300 ring-1 ring-emerald-400/30 hover:bg-emerald-400/15 hover:text-emerald-200 hover:ring-emerald-400/50"
      }
      hover:-translate-y-0.5 hover:shadow-xl`}
        >
          Contact

          <!-- subtle glow dot -->
          <span
            class="ml-2 inline-block h-2 w-2 rounded-full bg-emerald-400/80 shadow-[0_0_12px_rgba(52,211,153,0.65)]"
            aria-hidden="true"></span>
        </a>
      </li>
    </ul>

    <!-- Right: Actions -->
    <div
      class="flex items-center gap-4 text-base text-gray-700 dark:text-gray-300"
    >
      <!-- Language toggle -->
      <button
        aria-label="Toggle language"
        class="p-2 rounded-md hover:text-emerald-600 dark:hover:text-emerald-400
           transition-colors"
      >
        <!-- Heroicons: Globe -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
          class="h-5 w-5"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 3c4.97 0 9 4.03 9 9s-4.03 9-9 9
           -9-4.03-9-9 4.03-9 9-9z"
          ></path>
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 12h18M12 3a15.3 15.3 0 010 18M12 3a15.3 15.3 0 000 18"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile menu button -->
    <button
      type="button"
      class="lg:hidden inline-flex items-center justify-center rounded-xl
         border border-emerald-500/25 bg-emerald-500/10
         px-3 py-2 text-emerald-600 dark:text-emerald-300
         hover:bg-emerald-500/15 hover:border-emerald-500/40
         transition"
      aria-label="Open menu"
      aria-controls="mobile-nav"
      aria-expanded="false"
      data-mobile-menu-button
    >
      <!-- icon -->
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        class="h-5 w-5"
      >
        <path stroke-linecap="round" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>
</nav>

<script is:inline>
  const btn = document.querySelector("[data-mobile-menu-button]");
  const menu = document.querySelector("[data-mobile-menu]");

  if (btn && menu) {
    const setOpen = (open) => {
      menu.classList.toggle("hidden", !open);
      btn.setAttribute("aria-expanded", open ? "true" : "false");
    };

    btn.addEventListener("click", () => {
      const isOpen = btn.getAttribute("aria-expanded") === "true";
      setOpen(!isOpen);
    });

    // Close on outside click
    document.addEventListener("click", (e) => {
      if (!menu.contains(e.target) && !btn.contains(e.target)) setOpen(false);
    });

    // Close on ESC
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") setOpen(false);
    });

    // Close after clicking a link
    menu
      .querySelectorAll("a")
      .forEach((a) => a.addEventListener("click", () => setOpen(false)));
  }
</script>

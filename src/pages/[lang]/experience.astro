---
import Layout from "../../layouts/Layout.astro";
import Reveal from "../../components/Reveal.astro";
import { LANGS, type Lang, t } from "../../i18n";

export async function getStaticPaths() {
  return LANGS.map((lang) => ({ params: { lang } }));
}

const lang = Astro.params.lang as Lang;

// ✅ SEO por página
const pageSeo = {
  en: {
    title: "Professional Experience | Raúl García Balongo",
    description:
      "Professional experience in software development and data-oriented projects, including internships and academic work.",
  },
  es: {
    title: "Experiencia profesional | Raúl García Balongo",
    description:
      "Experiencia profesional en desarrollo de software y proyectos orientados a datos, incluyendo prácticas y trabajo académico.",
  },
};
---

<Layout lang={lang} pageSeo={pageSeo}>
  <section class="max-w-5xl mx-auto px-4 py-20 space-y-16">
    <!-- PAGE TITLE -->
    <Reveal as="header" class="max-w-3xl mx-auto text-center" delay={0}>
      <h1
        class="text-4xl md:text-5xl font-bold tracking-tight
               leading-[1.15] pb-1
               bg-linear-to-r from-emerald-400 via-teal-400 to-green-500
               bg-clip-text text-transparent"
      >
        {t(lang, "experience.title")}
      </h1>

      <Reveal delay={120}>
        <p
          class="mt-5 text-lg md:text-xl leading-relaxed
                 text-gray-600 dark:text-gray-300"
        >
          {t(lang, "experience.subtitle")}
        </p>
      </Reveal>
    </Reveal>

    <!-- TIMELINE -->
    <section class="space-y-8">
      <!-- Header -->
      <Reveal as="header" class="space-y-3" delay={0}>
        <h2
          class="text-2xl md:text-3xl font-semibold
         text-emerald-500 tracking-tight"
        >
          {t(lang, "experience.timeline.title")}
        </h2>

        <Reveal delay={120}>
          <div
            class="h-0.5 w-16
               bg-linear-to-r from-emerald-400 to-teal-400
               rounded-full"
          >
          </div>
        </Reveal>
      </Reveal>

      <!-- Timeline -->
      <div class="relative">
        <!-- Vertical line (NO Reveal aquí) -->
        <div
          class="pointer-events-none absolute left-4 md:left-1/2 top-0 bottom-0
           w-px md:-translate-x-1/2
           bg-linear-to-b from-emerald-500/10 via-emerald-400/40 to-green-500/10"
          aria-hidden="true"
        >
        </div>

        <div class="space-y-10">
          {
            [
              {
                side: "left",
                titleKey: "experience.items.paper.title",
                subtitleKey: "experience.items.paper.subtitle",
                periodKey: "experience.items.paper.period",
                gradeKey: "experience.items.paper.grade",
                logo: "/assets/images/projects/moodle.png",
                descKey: "experience.items.paper.desc",
                tags: [
                  "Research",
                  "Scientific Writing",
                  "Educational Analytics",
                  "Data Analysis",
                  "Visualization",
                ],
              },

              {
                side: "right",
                titleKey: "experience.items.mda.title",
                subtitleKey: "experience.items.mda.subtitle",
                periodKey: "experience.items.mda.period",
                grade: "9.8/10", // número -> lo dejamos tal cual
                logo: "/assets/images/projects/moodle.png",
                descKey: "experience.items.mda.desc",
                tags: [
                  "React",
                  "TypeScript",
                  "Webpack",
                  "Chart.js",
                  "TailwindCSS",
                  "Docker",
                  "Agile",
                ],
                repoUrl:
                  "https://github.com/Raulgb4/BrowserExtension-MoodleDataAnalysis/tree/develop",
              },

              {
                side: "left",
                titleKey: "experience.items.dekra.title",
                subtitleKey: "experience.items.dekra.subtitle",
                periodKey: "experience.items.dekra.period",
                grade: "10/10",
                logo: "/assets/images/LogoDEKRA.png",
                descKey: "experience.items.dekra.desc",
                tags: [
                  "Python",
                  "Django",
                  "Angular",
                  "APIs",
                  "Git",
                  "Jira",
                  "PostgreSQL",
                  "Docker",
                ],
              },

              {
                side: "right",
                titleKey: "experience.items.degree.title",
                subtitleKey: "experience.items.degree.subtitle",
                periodKey: "experience.items.degree.period",
                grade: "7.4/10",
                logo: "/assets/images/LogoUMA.png",
                descKey: "experience.items.degree.desc",
                tags: [
                  "Programming",
                  "Databases",
                  "Math",
                  "Statistics",
                  "Python",
                  "SQL",
                  "Power BI",
                  "Cloud",
                ],
              },

              {
                side: "left",
                titleKey: "experience.items.bach.title",
                subtitleKey: "experience.items.bach.subtitle",
                periodKey: "experience.items.bach.period",
                grade: "8/10",
                logo: "/assets/images/LogoTorreAlmirante.png",
                descKey: "experience.items.bach.desc",
                tags: [
                  "Logical Thinking",
                  "Mathematics",
                  "Problem Solving",
                  "Foundations",
                ],
              },
            ].map((item, idx) => (
              <Reveal delay={80 + idx * 60}>
                <div class="relative grid md:grid-cols-2 md:gap-10">
                  {/* Marker */}
                  <div
                    class="absolute left-4 md:left-1/2 top-7
               h-3 w-3 rounded-full
               bg-emerald-400/80
               ring-4 ring-emerald-400/15
               md:-translate-x-1/2"
                    aria-hidden="true"
                  />

                  {/* Left column */}
                  <div
                    class={`${
                      item.side === "left"
                        ? "md:pr-10"
                        : "md:pr-10 md:col-start-1 md:opacity-0 md:pointer-events-none"
                    }`}
                  >
                    {item.side === "left" && (
                      <article
                        class="ml-10 md:ml-0 md:justify-self-end
                   w-full max-w-xl
                   rounded-2xl border border-emerald-500/25
                   bg-white/60 dark:bg-white/5 backdrop-blur
                   p-6 shadow-sm
                   transition-all duration-300
                   hover:-translate-y-1 hover:shadow-lg hover:shadow-emerald-500/20
                   hover:border-emerald-400/60"
                      >
                        <div class="flex items-start justify-between gap-4">
                          <div class="flex items-start gap-4">
                            {item.logo && (
                              <img
                                src={item.logo}
                                alt={`${t(lang, item.titleKey)} ${t(lang, "common.logo")}`}
                                class="h-12 w-12 md:h-14 md:w-14
                           rounded-lg object-contain
                           border border-emerald-500/20
                           bg-white/80 dark:bg-white/10
                           p-1.5"
                                loading="lazy"
                              />
                            )}

                            <div class="min-w-0">
                              <h3 class="text-lg md:text-xl font-semibold text-gray-900 dark:text-white">
                                {t(lang, item.titleKey)}
                              </h3>
                              <p class="mt-1 text-sm text-gray-600 dark:text-gray-300">
                                {t(lang, item.subtitleKey)}
                              </p>
                            </div>
                          </div>

                          <div class="shrink-0 text-right">
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                              {t(lang, item.periodKey)}
                            </p>

                            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                              {t(lang, "experience.gradeLabel")}{" "}
                              <span class="font-medium text-gray-700 dark:text-gray-200">
                                {item.gradeKey
                                  ? t(lang, item.gradeKey)
                                  : item.grade}
                              </span>
                            </p>
                          </div>
                        </div>

                        <p class="mt-4 text-base md:text-lg leading-relaxed text-gray-600 dark:text-gray-300">
                          {t(lang, item.descKey)}
                        </p>

                        <div class="mt-4 flex flex-wrap gap-2">
                          {item.tags.map((tag) => (
                            <span
                              class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium
                         border border-emerald-500/25 bg-emerald-500/10 text-emerald-400"
                            >
                              {tag}
                            </span>
                          ))}
                        </div>
                      </article>
                    )}
                  </div>

                  {/* Right column */}
                  <div
                    class={`${
                      item.side === "right"
                        ? "md:pl-10"
                        : "md:pl-10 md:opacity-0 md:pointer-events-none"
                    }`}
                  >
                    {item.side === "right" && (
                      <article
                        class="ml-10 md:ml-0
                   w-full max-w-xl
                   rounded-2xl border border-emerald-500/25
                   bg-white/60 dark:bg-white/5 backdrop-blur
                   p-6 shadow-sm
                   transition-all duration-300
                   hover:-translate-y-1 hover:shadow-lg hover:shadow-emerald-500/20
                   hover:border-emerald-400/60"
                      >
                        <div class="flex items-start justify-between gap-4">
                          <div class="flex items-start gap-4">
                            {item.logo && (
                              <img
                                src={item.logo}
                                alt={`${t(lang, item.titleKey)} ${t(lang, "common.logo")}`}
                                class="h-12 w-12 md:h-14 md:w-14
                           rounded-lg object-contain
                           border border-emerald-500/20
                           bg-white/80 dark:bg-white/10
                           p-1.5"
                                loading="lazy"
                              />
                            )}

                            <div class="min-w-0">
                              <h3 class="text-lg md:text-xl font-semibold text-gray-900 dark:text-white">
                                {t(lang, item.titleKey)}
                              </h3>
                              <p class="mt-1 text-sm text-gray-600 dark:text-gray-300">
                                {t(lang, item.subtitleKey)}
                              </p>
                            </div>
                          </div>

                          <div class="shrink-0 text-right">
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                              {t(lang, item.periodKey)}
                            </p>

                            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                              {t(lang, "experience.gradeLabel")}{" "}
                              <span class="font-medium text-gray-700 dark:text-gray-200">
                                {item.gradeKey
                                  ? t(lang, item.gradeKey)
                                  : item.grade}
                              </span>
                            </p>
                          </div>
                        </div>

                        <p class="mt-4 text-base md:text-lg leading-relaxed text-gray-600 dark:text-gray-300">
                          {t(lang, item.descKey)}
                        </p>

                        <div class="mt-4 flex flex-wrap gap-2">
                          {item.tags.map((tag) => (
                            <span
                              class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium
                         border border-emerald-500/25 bg-emerald-500/10 text-emerald-400"
                            >
                              {tag}
                            </span>
                          ))}
                        </div>
                      </article>
                    )}
                  </div>
                </div>
              </Reveal>
            ))
          }
        </div>
      </div>
    </section>

    <!-- RESEARCH -->
    <section class="space-y-4">
      <!-- Header -->
      <Reveal as="header" class="space-y-3" delay={0}>
        <h2
          class="text-2xl md:text-3xl font-semibold
             text-emerald-500 tracking-tight"
        >
          {t(lang, "experience.research.title")}
        </h2>

        <Reveal delay={80}>
          <div
            class="h-0.5 w-16
               bg-linear-to-r from-emerald-400 to-teal-400
               rounded-full"
          >
          </div>
        </Reveal>
      </Reveal>

      <!-- Content -->
      <Reveal delay={160}>
        <div class="rounded-lg border border-gray-200 dark:border-gray-700 p-6">
          <p class="text-gray-600 dark:text-gray-300">
            {t(lang, "experience.research.desc")}
          </p>
        </div>
      </Reveal>
    </section>

    <!-- PROJECTS -->
    <section class="space-y-6">
      <!-- Section header (mismo estilo que Research) -->
      <Reveal as="header" class="space-y-3" delay={0}>
        <h2
          class="text-2xl md:text-3xl font-semibold text-emerald-500 tracking-tight"
        >
          {t(lang, "projects.featured.title")}
        </h2>

        <Reveal delay={80}>
          <div
            class="h-0.5 w-16 bg-linear-to-r from-emerald-400 to-teal-400 rounded-full"
          >
          </div>
        </Reveal>

        <Reveal delay={140}>
          <p class="text-gray-600 dark:text-gray-300 max-w-3xl">
            {t(lang, "projects.featured.subtitle")}
          </p>
        </Reveal>
      </Reveal>

      <!-- Cards grid -->
      <Reveal delay={200}>
        <div class="grid gap-6 items-start">
          {
            [
              {
                title: t(lang, "projects.moodle.title"),
                badge: t(lang, "projects.badge.public"),

                institution: t(lang, "projects.moodle.institution"),
                type: t(lang, "projects.moodle.type"),
                grade: "9.8/10",

                description: t(lang, "projects.moodle.desc.short"),
                longDescription: t(lang, "projects.moodle.desc.long"),

                covers: [
                  "/assets/images/projects/moodle.png",
                  "/assets/images/projects/moodle-1.png",
                  "/assets/images/projects/moodle-2.png",
                  "/assets/images/projects/moodle-3.png",
                  "/assets/images/projects/moodle-4.png",
                  "/assets/images/projects/moodle-5.png",
                  "/assets/images/projects/moodle-6.png",
                  "/assets/images/projects/moodle-7.png",
                  "/assets/images/projects/moodle-8.png",
                  "/assets/images/projects/moodle-9.png",
                ],

                tech: "TypeScript · React · Tailwind",
                technologies: [
                  "React",
                  "Webpack",
                  "Chart.js",
                  "TailwindCSS",
                  "Docker",
                  t(lang, "projects.tech.agile"),
                ],

                repoUrl:
                  "https://github.com/Raulgb4/BrowserExtension-MoodleDataAnalysis/tree/develop",
              },

              {
                title: t(lang, "projects.portfolio.title"),
                badge: t(lang, "projects.badge.public"),

                description: t(lang, "projects.portfolio.desc"),
                cover: "/assets/images/projects/portfolio.png",
                tech: "Astro · Tailwind CSS · TypeScript · React",
                demoUrl: "#",
                repoUrl: "https://github.com/Raulgb4/raulgb4.github.io",
              },
            ]

              .slice(0, 3)
              .map((p, idx) => (
                <Reveal delay={260 + idx * 90}>
                  <article
                    class="group relative overflow-hidden rounded-2xl
             border border-emerald-500/25
             bg-white/60 dark:bg-white/5 backdrop-blur
             shadow-sm transition-all duration-300
             hover:-translate-y-1 hover:shadow-lg hover:shadow-emerald-500/20
             hover:border-emerald-400/60"
                  >
                    <div
                      class="pointer-events-none absolute -top-24 -left-24 h-64 w-64 rounded-full
               bg-emerald-500/15 blur-3xl opacity-0 transition-opacity duration-500
               group-hover:opacity-100"
                      aria-hidden="true"
                    />

                    <div class="grid md:grid-cols-[420px_1fr]">
                      <div class="relative overflow-hidden" data-carousel>
                        {/* Track */}
                        <div class="relative h-56 md:h-full md:min-h-65">
                          <div
                            class="flex h-full w-full transition-transform duration-500 ease-out"
                            data-carousel-track
                            style="transform: translateX(0%)"
                          >
                            {(p.covers ?? [p.cover]).map((src, i) => (
                              <div class="h-full w-full shrink-0">
                                <img
                                  src={src}
                                  alt={`${p.titleKey ? t(lang, p.titleKey) : p.title} ${t(
                                    lang,
                                    "projects.screenshot",
                                  )} ${i + 1}`}
                                  class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.03]"
                                  loading="lazy"
                                />
                              </div>
                            ))}
                          </div>

                          {/* Overlay */}
                          <div
                            class="pointer-events-none absolute inset-0
                     bg-linear-to-t from-black/35 via-black/10 to-transparent
                     md:bg-linear-to-r md:from-black/25 md:via-black/10 md:to-transparent"
                            aria-hidden="true"
                          />
                        </div>

                        {/* Controls */}
                        <button
                          type="button"
                          class="absolute left-3 top-1/2 -translate-y-1/2
                   inline-flex h-9 w-9 items-center justify-center rounded-full
                   bg-black/35 text-white border border-white/20
                   opacity-0 transition-opacity duration-200
                   group-hover:opacity-100 focus:opacity-100"
                          aria-label={t(lang, "projects.prevImage")}
                          data-carousel-prev
                        >
                          ‹
                        </button>

                        <button
                          type="button"
                          class="absolute right-3 top-1/2 -translate-y-1/2
                   inline-flex h-9 w-9 items-center justify-center rounded-full
                   bg-black/35 text-white border border-white/20
                   opacity-0 transition-opacity duration-200
                   group-hover:opacity-100 focus:opacity-100"
                          aria-label={t(lang, "projects.nextImage")}
                          data-carousel-next
                        >
                          ›
                        </button>

                        {/* Dots */}
                        <div
                          class="absolute bottom-3 left-1/2 -translate-x-1/2
                   flex items-center gap-2 rounded-full
                   bg-black/25 border border-white/15 px-3 py-1.5
                   opacity-0 transition-opacity duration-200
                   group-hover:opacity-100 focus-within:opacity-100"
                          data-carousel-dots
                          aria-label={t(lang, "projects.carouselPagination")}
                        />
                      </div>

                      <div class="relative p-6 md:p-7">
                        <div class="flex items-start justify-between gap-4">
                          <div class="min-w-0">
                            <h3 class="text-xl md:text-2xl font-semibold tracking-tight text-gray-900 dark:text-white">
                              {p.titleKey ? t(lang, p.titleKey) : p.title}
                            </h3>

                            {(p.institutionKey ||
                              p.typeKey ||
                              p.institution ||
                              p.type) && (
                              <p class="mt-1 text-sm text-gray-600 dark:text-gray-300">
                                <span class="font-medium">
                                  {p.institutionKey
                                    ? t(lang, p.institutionKey)
                                    : p.institution}
                                </span>
                                {(p.typeKey || p.type) && (
                                  <span class="text-gray-500 dark:text-gray-400">
                                    {" "}
                                    · {p.typeKey ? t(lang, p.typeKey) : p.type}
                                  </span>
                                )}
                              </p>
                            )}
                          </div>

                          <div class="shrink-0 flex flex-col items-end gap-2">
                            <span
                              class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium
                       border border-emerald-500/25
                       bg-emerald-500/10 text-emerald-500"
                            >
                              {p.badgeKey ? t(lang, p.badgeKey) : p.badge}
                            </span>

                            {(p.periodKey ||
                              p.period ||
                              p.gradeKey ||
                              p.grade) && (
                              <div class="text-xs text-gray-500 dark:text-gray-400 text-right leading-snug">
                                {(p.periodKey || p.period) && (
                                  <div>
                                    {p.periodKey
                                      ? t(lang, p.periodKey)
                                      : p.period}
                                  </div>
                                )}
                                {(p.gradeKey || p.grade) && (
                                  <div class="mt-1">
                                    {t(lang, "projects.gradeLabel")}{" "}
                                    <span class="font-medium text-gray-700 dark:text-gray-200">
                                      {p.gradeKey
                                        ? t(lang, p.gradeKey)
                                        : p.grade}
                                    </span>
                                  </div>
                                )}
                              </div>
                            )}
                          </div>
                        </div>

                        <p class="mt-3 text-base md:text-lg leading-relaxed text-gray-600 dark:text-gray-300">
                          {p.descriptionKey
                            ? t(lang, p.descriptionKey)
                            : p.description}
                        </p>

                        <div class="mt-5 flex flex-wrap items-center gap-x-5 gap-y-2 text-sm text-gray-600 dark:text-gray-300">
                          <span class="inline-flex items-center gap-2">
                            <span class="h-2.5 w-2.5 rounded-full bg-emerald-400/80" />
                            <span class="font-medium">
                              {Array.isArray(p.technologies)
                                ? p.technologies.slice(0, 6).join(" · ")
                                : p.tech}
                            </span>
                          </span>
                        </div>

                        <div class="mt-6 flex">
                          <a
                            href={p.repoUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center justify-center gap-2
                     rounded-lg px-4 py-2
                     text-sm font-semibold
                     text-emerald-400
                     border border-emerald-500/40
                     transition-all duration-300
                     hover:bg-emerald-500/10 hover:-translate-y-0.5
                     hover:border-emerald-400"
                          >
                            {t(lang, "projects.repository")}
                            <span aria-hidden="true">↗</span>
                          </a>
                        </div>
                      </div>
                    </div>
                  </article>
                </Reveal>
              ))
          }
        </div>
      </Reveal>
    </section>
  </section>

  <script is:inline>
    const carousels = document.querySelectorAll("[data-carousel]");

    carousels.forEach((root) => {
      const track = root.querySelector("[data-carousel-track]");
      const slides = track ? track.children.length : 0;

      if (!track || slides <= 1) {
        // Si solo hay 1 imagen, ocultamos controles/dots (opcional)
        const prev = root.querySelector("[data-carousel-prev]");
        const next = root.querySelector("[data-carousel-next]");
        const dots = root.querySelector("[data-carousel-dots]");

        if (prev instanceof HTMLElement) prev.classList.add("hidden");
        if (next instanceof HTMLElement) next.classList.add("hidden");
        if (dots instanceof HTMLElement) dots.classList.add("hidden");

        return;
      }

      const btnPrev = root.querySelector("[data-carousel-prev]");
      const btnNext = root.querySelector("[data-carousel-next]");
      const dotsWrap = root.querySelector("[data-carousel-dots]");

      let index = 0;

      // Dots
      const dots = [];
      for (let i = 0; i < slides; i++) {
        const b = document.createElement("button");
        b.type = "button";
        b.setAttribute("aria-label", `Go to image ${i + 1}`);
        b.className =
          "h-2 w-2 rounded-full border border-white/20 transition-all duration-200";
        b.addEventListener("click", () => goTo(i));
        dotsWrap.appendChild(b);
        dots.push(b);
      }

      const setActive = () => {
        dots.forEach((d, i) => {
          d.classList.toggle("bg-white/80", i === index);
          d.classList.toggle("bg-white/25", i !== index);
          d.classList.toggle("w-5", i === index);
          d.classList.toggle("w-2", i !== index);
        });
      };

      const goTo = (i) => {
        index = (i + slides) % slides;
        track.style.transform = `translateX(-${index * 100}%)`;
        setActive();
      };

      btnPrev?.addEventListener("click", () => goTo(index - 1));
      btnNext?.addEventListener("click", () => goTo(index + 1));

      // Keyboard (cuando el ratón está encima o hay foco)
      root.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") goTo(index - 1);
        if (e.key === "ArrowRight") goTo(index + 1);
      });

      // Hacer el root focusable para flechas si quieres
      root.setAttribute("tabindex", "0");

      setActive();
    });
  </script>
</Layout>
